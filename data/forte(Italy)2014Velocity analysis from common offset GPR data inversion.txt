Forte
Velocity analysis from common offset GPR data inversion: theory and application to synthetic and real data
2014
Geophysical Journal International

Velocity analysis from common offset GPR data inversion: theory and application to synthetic and real data
SUMMARY 
We implemented a procedure to estimate the electromagnetic (EM) velocity using common offset ground penetrating radar (GPR) data. The technique is based on the inversion of reflection amplitudes to compute the series of reflection coefficients used to estimate the velocity in each interpreted layer. The proposed method recursively calculates the incident angles at any interface, taking into account the offset between antennas, and needs as input, in addition to the picked amplitudes values, a reference amplitude for each analysed GPR trace and a velocity value for the first (shallowest) layer. The latter two parameters can be estimated directly from the available data or can be better constrained by further dedicated GPR acquisitions or by additional direct measurements. We critically evaluated the performances for both synthetic and real data acquired with different antenna frequencies and we demonstrated that the new method can be applied in several real situations. Despite the necessary approximations and simplifying hypotheses, the velocity values calculated for each layer are consistent with direct information and with cross-validations obtained considering profiles acquired using different antennas and various path directions. Tests of the method on synthetic and real data sets show that the errors in the calculated velocity fields are quite low and comparable with more demanding velocity analysis techniques. The obtained EM velocity field is crucial in many processing steps, such as, for example, true amplitude recovery, depth conversion and imaging, and provide essential information to characterize the subsurface materials.

Key words: 
Image processing; Electrical properties; Electromagnetic theory; Magnetic and electrical properties.

INTRODUCTION
Ground penetrating radar (GPR) is a high-resolution geophysical technique based on the propagation of electromagnetic (EM) waves within a frequency range between about 1 MHz and 3 GHz. GPR is increasingly used to image the shallow subsurface by recording the reflections of an EM pulse, caused by changes in the dielectric properties of the investigated materials. High values of electrical conductivity generate low investigation depths due to the strong attenuation effects, like in case of clayey soils or materials with high water content. The GPR data, after the application of an appropriate processing, can be used to obtain a reliable subsurface imaging both in 2-D and 3-D.
The formal equivalence between seismic and EM waves (Ursin 1983; Carcione 2007) allows using seismic processing and analysis algorithms in GPR applications (e.g. Fisher et al. 1992; Daniels 2004; Jol 2009).
The main differences regard the perturbing field characteristics and physical parameters, such as frequency, velocity, impedance behaviour and, obviously, scale of applicability.
The EM wave velocity is an essential parameter in the following steps of GPR applications, which are separately discussed: 
(1) Depth conversion.
(2) Data processing.
(3) Data imaging.
(4) Qualitative/quantitative information about characteristics and variations of lithology and fluid content.
GPR experiments allow to record the amplitudes of EM waves reflected at discontinuities in EM properties in the subsurface as a function of traveltime, which is usually measured starting from the instant of excitation of the transmitting antenna. Variations in the subsurface EM properties are associated to both changes of the solid matrix (i.e. rocks or sediments) and variations in fluid content and composition (Davis & Annan 1989). In order to convert the two-way traveltime (TWT) into depth below the surface it is essential to know in detail the EM velocity field, that is, ideally, the EM velocity at any subsurface point. The accuracy/affordability of such estimation basically depends on three factors: the complexity of the subsurface (obviously not controlled by the geophysicist); the GPR instrument and the acquisition parameters (selected by the geophysicist). One or few velocity functions can be adopted in case of isotropic and moderately heterogeneous materials, even when the areas of study are relatively large. Nonetheless, in most GPR applications, depth conversion requires an accurate reconstruction of the velocity field. A synthetic review of the most common methods to estimate EM wave velocities from GPR data is discussed in the following section.
Velocity is an essential parameter in several processing steps, such as amplitude recovery (gain), static corrections and dynamic corrections (of multioffset data). In particular, the amplitude corrections (both for radiation pattern and geometrical spreading) are a crucial task for any further quantitative analysis based on dynamic properties of the GPR waves and can be determined only when the EM velocities are known.
Subsurface imaging by means of migration algorithms corrects distortions of dipping and curved reflectors and collapses diffractions at the true scatterer locations. Most of the established solutions in seismic migration practice (pre-stack/post-stack; time/depth; 2-D/3-D) require a velocity field that is obtained through migration velocity analysis (MVA) techniques (Grasmueck 1996; Leparoux et al. 2001; Bradford & Harper 2005; Brown et al. 2009).
In GPR applications, migration is often performed assuming a constant velocity or a very simplified velocity field. Both strategies do not take into account heterogeneity and anisotropy factors, which can be particularly important at shallow depths. Therefore, the resulting images are only approximations of the real subsurface geometry, which may bring on mistakes and inaccuracies in the data interpretation. On the other hand, more sophisticated algorithms, like the topographic migration (Lehmann & Green 2000; Dujardin & Bano 2013), require a very accurate velocity field estimation.
EM velocity variations in the subsurface are strongly linked to content and composition of the fluids within sediments and rocks. Therefore, it is possible to derive several useful petrophysical parameters, such as porosity, fluid type and saturation, from the knowledge of the velocity. Topp et al. (1980) first applied time-domain reflectometry (TDR) to measure the EM velocity, derive the dielectric constant and estimate the volumetric water content on a wide range of sediments and over the same frequency interval used for GPR. They further proposed an empirical relation between the latter two parameters.
The velocity of EM waves, estimated from surface multioffset and borehole measurements, was further applied to obtain hydrological properties both in the saturated (e.g. Greaves et al. 1996; Gloaguen et al. 2001; Sénéchal et al. 2005) and vadose zones (Loeffler & Bano 2004; Cassiani & Binley 2005; Deiana et al. 2008; Looms et al. 2008). A detailed summary of GPR applications in hydrogeophysics is provided by Lambot et al. (2008), while Huisman et al. (2003) review the techniques applied to estimate soil water content.
Several other GPR applications are related to the location and characterization of pollutants, using both velocity and attenuation as main parameters (e.g. Brewster & Annan 1994; Cassidy 2007; Bradford 2008; Cassidy 2008).
Velocity/dielectric constants are further being used to characterize the inner structure of ice and to derive several glaciological parameters, like density, free water and salt content (e.g. Annan & Davis 1976; Macheret et al. 1993; Arcone 1996; Bradford & Harper 2005; Brown et al. 2012; Forte et al. 2013).
In the following section we summarize the methods currently applied to estimate the EM wave velocity from different GPR acquisition schemes.

EM WAVE VELOCITYES ESTIMATION FROM GPR DATA
In a lossy medium, the velocity of a transverse EM wave, vm , within a material having electric conductivity, σ , dielectric permittivity, ε and magnetic permeability, μ, is given by (e.g. Balanis 1989): 
where tanδ is the loss tangent equal to:
All the previous parameters are scalars only if the considered medium is homogeneous and isotropic; otherwise they are generally both complex and frequency dependent, and can be written as:
Such equations can be simplified when we consider specific applications, in which the materials can be either good or bad dielectrics with isotropic or anisotropic characteristics. Such approximations will be discussed later in the explanation of the new proposed velocity estimation method.
In seismic studies, the velocity model is usually obtained through the analysis of data collected at multiple source–receiver offsets (e.g. Yilmaz 2001). However, most commercial GPR systems are equipped with a single receiver antenna; therefore, the acquisition of multioffset data sets is extremely demanding (Pipan et al. 1999). As a result, the velocity field used for GPR imaging is most often a constant value or, less frequently, a single simplified v(z) function, obtained from the analysis of a single common midpoint (CMP) gather. In most subsurface conditions, such type of velocity field is inadequate to produce good images even for qualitative information.
Multichannel GPR systems have recently gained increasing diffusion, thereby opening new possibilities for fast and accurate reconstruction of the subsurface. One advantage of such systems is that they can significantly reduce 3-D survey times by simultaneously collecting multiple profiles. An even more powerful feature of the new multichannel systems is the full multioffset data measurement (i.e. performed at each survey point) through multiple antennas at different offsets. Such continuous multioffset data gathering can be used to estimate EM velocities over the whole survey area (e.g. Moysey 2011), while traditional single-channel GPR systems normally limit CMP data acquisition to only a few locations. It is thus possible to process such data to obtain detailed maps of EM wave velocities with centimetric horizontal resolution, by applying one of the well-known algorithms originally implemented for reflection seismic data, like semblance analysis (Tillard & Dubois 1995; Greaves et al. 1996), pre-stack depth MVA (Perroud & Tygel 2005; Bradford et al. 2009), tomographic techniques (Cai & McMechan 1999; Hanafy & Hagrey 2006) or other specific methodologies applicable only to special cases (e.g. Reppert et al. 2000; van der Kruk et al. 2006; Strobbia & Cassiani 2007).
Besides the previously mentioned advantages, the new multichannel GPR systems have some logistical constraints, mainly related to their dimensions, which prevent their application in indoor surveys, in remote zones out of reach by motorized vehicles or in case of rough topography. In addition, the velocity analysis, which can be performed on multioffset (and so multifold) GPR data, does not generally provide very accurate estimates, mainly because GPR velocity often decreases with depth, unlike seismic velocity. Therefore, some assumptions in classical velocity analyses, such as assimilating rms velocity to stack velocity, produce inaccurate results when applied to GPR data (Becht et al. 2006).
The EM wave velocity can even be estimated from common offset (CO) data by taking into account the diffracted events recorded on the GPR profiles. It is well known that the EM radiation generated by GPR is partly scattered when the soil contains objects having size smaller than (Rayleigh) or approximately equal to (Mie) its mean wavelength (e.g. Grasmueck et al. 2005). The most common velocity analysis techniques are ‘Diffraction hyperbola fitting’ and ‘Migration velocity scan’. They both exploit the curvature of diffraction hyperbolas and can also be applied in an integrated way for any hyperbolic event within a GPR section. In situations where no reflections occur (e.g. in some urban environment), these are the only available methods. The main disadvantages are related to the accuracy/resolution, since only few hyperbolas can usually be analysed and they are irregularly distributed within the section. Moreover, in case of elongated targets (e.g. pipes), the traveltime curve is hyperbolic only if GPR profile and target axis are almost perpendicular. On the other hand, if the GPR profile is parallel to the target axis, we will register only a reflection. Furthermore, in real applications, the observed events are frequently a combination of reflections and diffractions rather than pure diffractions. In such cases, hyperbola fitting results in incorrect estimations.
A more detailed critical review of the current practice in EM wave velocity estimation can be found in Forte et al. (2013).

THE NEW METHODOLOGY 
The proposed procedure to estimate the EM wave velocity profile v(z) at each trace location of 2-D bi-static CO GPR profiles is based on the principles of geometrical ray theory.
From the dynamic point of view, we take into account reflection and transmission coefficients and remove the effect of geometrical spreading. We disregard variations in antenna coupling, intrinsic attenuation and scattering effects.
The propagating signal is assumed as a plane EM wave, while in the proximity of each trace location the subsurface is supposed horizontally layered (Fig. 1). Each layer is homogeneous, isotropic, non-magnetic (μr = 1), non-conductive (σ = 0) and non-dispersive. Although such characteristics do not exactly represent average earth materials, they are reasonable approximations of common subsurface conditions in which EM waves propagate efficiently (Davis & Annan 1989).
With these assumptions, the proposed methodology requires as input the value of the offset (x), the velocity of the GPR signal in the first layer (v1 ), the peak amplitude of the wavelet incident on the first interface (Ai1 ) and the peak amplitudes (Asi ) and traveltimes (T W Ti ) of the reflected waves recorded by the receiver, corrected for geometrical spreading.
Normal GPR surveys are performed in transverse electric (TE) broadside configuration (also reported as perpendicular or transverse polarization), that is, with the electric field oscillating perpendicular to the survey direction (e.g. Jol 2009). We will, therefore, consider only the TE mode, while the same approach can be nonetheless extended to the transverse magnetic (TM) configuration.
The proposed procedure has an iterative structure: from the first n – 1 layer thicknesses and the EM velocities in the first n layers, the nth cycle calculates the thickness of the nth layer and the velocity in the (n + 1)th layer by reconstructing the propagation path of the nth reflected wave. The first cycle constitutes a simplified version of the nth cycle, with the thickness of the first layer, the angle of incidence (θ1) and the reflection coefficient (R1) for the first reflection given by the following relations:
where As1 and Ai1 are the reflected and incident amplitudes of the first interface, respectively. Snell’s equation then gives the velocity of the GPR signal in the second layer: 
obtained by rearranging the Fresnel equation for the TE mode (e.g. Balanis 1989).
In the nth cycle, the TWTn of the wave reflected by the nth interface is given by the equation:   where h i and vi are the thickness and the EM wave velocity in the ith layer, respectively.
If we know the thicknesses of the first n – 1 layers, the velocities of the GPR signal in the first n layers and the TWTn of the wave reflected by the nth interface, the thickness (h n ) of the nth layer is the only positive solution of the following third-degree equation, obtained by rearranging (8):
In a horizontally layered medium, the incident angle for the kth interface is equal to the transmitted angle for the (k – 1)th interface. Such angle (θ k ) is related to the horizontal projection of the travel path in the kth layer (Fig. 1) through the following equation:
For small values of θk, (15) becomes: 
This approximation is justified by considering the small value of the offset and the depths of the interfaces (‘small spread approximation’), so that xk is small compared to h k in each layer.
By applying (16) to the Snell’s equation we obtain:
Using (15) and (17), and the geometrical condition for the nth reflection we obtain the angles of incidence (θ k ) on all the interfaces along the path of the nth reflected wave as:
With such angles we can calculate the first n – 1 reflection and transmission coefficients relative to the nth reflected wave, using the Fresnel equation for TE antenna configuration:
Using these coefficients, and considering the symmetry of the travel path (Fig. 1), the incident and reflected amplitudes of the nth interface are given respectively by: 
From (22) and (23), we obtain the reflection coefficient of the nth interface for the nth reflected wave:
The velocity in the (n + 1)th layer is then given by the Snell’s equation:
and θ n given by (19) with k equal to n.
Note that (25) and (26), used in the nth cycle, are extensions of (6) and (7), used in the first cycle.
By iterating this method for all the interpreted reflections in a GPR trace, it is possible to obtain the thicknesses and velocities of all the imaged layers, by knowing: the EM velocity of the first one, the peak amplitude of the wavelet incident on the shallowest interface and the peak amplitudes and TWTs of all the reflections. This approach can be considered a generalization of similar procedures used for TDR measurements (Moffitt 1964; Topp et al. 1980).

APPLICATION TO SYNTHETIC DATA 
We tested the method on synthetic data obtained from forward 1-D modelling to verify results and performances. We created several synthetic GPR traces, by using different offset values and a generic wavelet, since the inversion process is just based on peak reflection amplitudes and reflection traveltimes. The procedure previously described was applied to such traces to reconstruct the initial model parameters, that is, the velocity values based on the picked amplitudes.
Table 1 reports both geometrical and physical parameters of three models with the following characteristics: increasing, decreasing and arbitrary velocity distribution, respectively. Such velocities are typical of frozen materials (being the end members 27.6 cm ns–1 for the fresh snow and 17 cm ns–1 for the pure ice), as the method was originally developed for applications to the study of glaciers, but the results can be extended to any other velocity range. Both modelling and inversion were implemented for the TE case only, the usual acquisition configuration for GPR surveys.
The three models have identical stratigraphy, and the velocity distributions include both small and large velocity contrasts, to test the performances of the inversion procedure in different conditions.
Reflections were numerically simulated by calculating the primary downgoing and upgoing wavefields without dissipation and geometrical spreading, because such attenuation effects must be corrected before the application of the method to real data. GPR traces were calculated at two different offsets (0.5 and 1.5 m) corresponding, on the first interface, to incident angles of 7.1◦ and 20.6◦ , respectively.
Amplitudes and traveltimes are required as input to the inversion procedure and were picked from the synthetic traces. The velocity of the first layer can be calculated from the ground wave arrival in real data and it is, therefore, assumed as a known parameter for the three models, as well as the offsets. Typical measurement uncertainties  were added to each input parameter, to estimate the error propagation, with confidence of the first layer velocity being the most important factor in determining the uncertainties of the results.
Table 2 gives the results of the inversion. All the values obtained from the inversion match the parameters of the original models (Table 1). It is important to note the general increase of the estimated error with depth, due to the iterative nature of the inversion algorithm. Moreover, while the estimated errors can grow quite large, depending mainly on the initial measurement uncertainties, the mean values are nonetheless very close to the real values used in the forward modelling.
It is useful to compare such results with those obtained by applying a similar methodology, based on a zero-offset geometry, which therefore considers all the incident angles equal to zero (Forte et al. 2013). The relevant results are given in Table 3.
The normal incidence approximation is valid when the offset can be considered small in comparison with the depth of the reflector (‘small spread approximation’), so that all incident angles are close to zero. In fact, in the first case of Table 3, the incident angle at the first interface is 7.1◦ and the mean values exhibit small deviations from those reported in Table 2. These differences are more evident in the second case, with a 20.6◦ incident angle at the first interface. Departures from the small spread conditions produce two primary effects: overestimation of the thickness of the first layer, due to underestimation of the travel path; and errors in the estimation of the reflection and transmission coefficients, due to the assumed normal incidence, that in turn affect the results in the deeper layers. It is also important to note that the calculated errors do not show an increase with depth caused by the iterative nature of the inversion, because the only quantity used in the zero-offset method is the dielectric permittivity.
The results obtained by considering normal incidence (Table 3) are partly inconsistent (values in bold) with the real models (Table 1). In these cases the resulting differences in mean values with the original models are nonetheless confined within ±0.77 cm ns–1 for velocity and ±0.27 m for layer thickness. These inconsistencies do not occur if we apply the procedure which takes into account the incident angles (Table 2).

APPLICATION ON REAL DATA 
Ideally, reflection amplitudes of a fully processed GPR data set should only be function of reflection coefficients, that is of the EM reflectivity. In real applications, several factors affect amplitudes, preventing a direct correlation with the reflection coefficients. In fact, the measured amplitude is an extremely complicated function of several parameters, most of which unknown or impossible to determine. However, with some simplifying assumptions, it is possible to reduce the complexity to a manageable problem and obtain amplitudes that can be realistically considered related only to the subsurface contrasts of EM impedance.
In a GPR experiment, even in case of virtually lossless materials, where intrinsic attenuation is negligible, amplitudes are primarily affected by the following factors (considering the antenna–ground coupling as a constant): (A) scattering, (B) geometrical spreading, (C) partial reflections.
(A) Diffractions can be focused by means of migration, which brings the recorded wavefield to the correct spatial position. 2-D migration is actually based on a cylindrical geometry, that is, there is no variation in the medium along an axial dimension perpendicular to the plane of the GPR section: this means that 2-D migration cannot take into account out of section energy. Nevertheless, it can be considered an adequate approximation in most real cases.
(B) Geometrical spreading can be corrected by using divergence recovery. Due to the antenna directivity, a precise correction can be obtained only if the radiation pattern into the subsurface is known. Since this can be measured only through complex polarimetric/ multicomponent experiments, a spherical divergence correction can be considered a valid first approximation. Moreover, in case of moderate lateral variations of medium properties and constant antenna– ground coupling, the radiation pattern does not significantly change at different sampling positions and so has a minor role in the problem.
(C) The effect of partial reflections can be analytically removed starting from the uppermost reflector down to the basal one.
Moreover, if we consider low conductivity materials (i.e. below 1 mS m–1 ), where the GPR signal propagates more efficiently (Davis & Annan 1989), the physical properties can be assumed as frequency independent over the GPR bandwidth.
A proper processing flow must be applied to the GPR data before amplitude picking. This operation must be prepared very carefully, since processing artefacts must be avoided in order to extract information from data amplitudes. In most cases, bandpass filtering and true amplitude recovery are necessary before amplitude picking. In fact, most coherent and random noise components can be effectively removed by bandpass filters, since the largest part of noise is out of the signal frequency band.
We tested the procedure on a data set acquired on a glacieret (Conca Prevala, Eastern Alps) with a Zond system equipped with 300 MHz, 500 MHz shielded antennas. This data set is very interesting for velocity estimation since the GPR investigates not only frozen materials having different densities, but also rock and debris with completely different EM properties. Moreover, the free water amount within the glacieret was negligible during the GPR survey and, therefore, the intrinsic attenuation can be disregarded. This is indirectly testified by the penetration depth of the GPR signal exceeding 20 m, even using 500 MHz antennas. Fig. 2 shows an example of a 300 MHz unprocessed (A), processed (B) and interpreted (C) profile. The complicated subsurface geometries are apparent as well as the numerous imaged reflectors, making the estimation of the EM velocities particularly interesting and intricate.
The high quality of the original data encouraged the application of a simple processing sequence that allowed amplitude preservation for the following inversion phase. It included these steps: DC removal, drift removal, spectral analysis and bandpass filtering, spatial filtering to remove ringing and late arrivals of the ground wave and, most importantly, the spherical divergence correction. In fact, this is the crucial correction for a proper ‘true amplitude’ recovery. For the divergence correction we used a constant 20 cm ns–1 velocity; this value was determined by integrating the analysis of CMP gathers and direct data obtained in a nearby snow pit dug concurrently to the GPR surveys. Inversion results obtained from 2-D migrated data do not show significant differences from the non-migrated data if we consider only the reflections, possibly due to the small dips of the glacieret’s stratigraphy. 3-D migration should be nonetheless considered in case of more complicated subsurface structures. We then automatically picked the maximum amplitudes (peaks or troughs) of the main reflections, at any trace position where the signal-tonoise ratio was high enough. Not all the picked amplitudes can be realistically considered only function of the subsurface reflectivity, especially due to interference (reflections from thin beds boundaries or reflection–diffraction partial superposition). Anyway, due to the large number of data available for the inversion of a GPR profile, such outliers have negligible statistical significance and do not affect the overall velocity estimation.
We considered as reference amplitude, that is the amplitude of the wavelet effectively transmitted into the ground by the GPR system, the peak value of the airwave. We noted that such values are almost constant and differ only slightly from trace to trace, testifying the nearly perfect system repetitiveness. The discrepancies between the reference amplitude of each trace and the median of all the traces are less than 5 per cent, but in the case of few outliers.
The velocity of the first layer was fixed as constant (20 cm ns–1 ) for all the study area and was obtained by combining local CMP analyses and direct density measurements performed on dedicated snow pits. In fact, using one of the well-known empirical relations (Looyenga 1965 for a two phase system in the present case) it is possible to estimate the dielectric permittivity of a frozen material (and, therefore, its EM velocity) from its density, or vice versa. In order to cross-validate the GPR data acquired with different antennas and to correlate the geophysical results with the snow pit information, we first analysed different GPR profiles (acquired with 300 and 500 MHz antennas), located around a snow pit where the frozen material’s densities have been measured during the GPR  survey. Fig. 3 shows three profiles and the plot of the measured densities. The mean density value down to 3.4 m is close to 600 kg m–3 , with maximum and minimum values of 670 and 540 kg m–3 , respectively. Such values correspond to an EM velocity close to 20 cm ns–1 . The low-density contrasts in the uppermost levels produce low amplitudes and discontinuous GPR reflections (like horizon h0 in Fig. 3), while the first strong density change occurs just below the snow pit bottom (horizon h1 ). Fig. 4 summarizes the results of the velocity estimation performed considering the amplitude picked along horizons h1 , h2 , h3 , h4 and h5 , the latter being the firn bottom (Fig. 3).
The velocities calculated from the picked amplitudes of the profiles close to the snow pit (Fig. 4) show a decreasing trend for increasing depths since the materials contain decreasing air volumes going from snow to firn and from firn to ice (e.g. Godio 2009). Beside some lateral changes, the general velocity trend is similar in the two 300 MHz crossing profiles (Figs 4A and B), with the deepest layer reaching velocities lower than 18 cm ns–1 typical for glacier ice. The comparison of the two profiles acquired along the same path with 300 and 500 MHz antennas (Figs 4B and C) shows an almost perfect match of the obtained velocity fields. In particular, both profiles exhibit a clear relatively high-velocity zone centred at the trench location. This is probably due to a shallow layer, whose bottom reflector is labelled h0 in Figs 2 and 3, that shows up locally (e.g. at the snow pit location) but is not used in velocity calculation due to its poor lateral coherence. It is interesting to note that the picked amplitudes of the 500 MHz profile had a 300 per cent constant gain applied before the inversion procedure to make them comparable with the 300 MHz ones. This suggests that the radiation pattern of the two antennas must be considerably different and that there is some frequency-dependent intrinsic attenuation of the frozen materials, probably related to some free water at least in the shallow levels.
We then calculated the EM velocity field for the whole GPR data set, using the amplitudes picked along all the interpreted reflectors. Fig. 5 shows the velocities obtained from the 300 MHz amplitudes (GPR data shown in Fig. 2). In the inversion process we only used values picked where reflectors are more continuous and the diffractions are not dominant. Such horizons are marked by continuous lines in Fig. 2(C). Reflectors having poor lateral coherence (dotted lines in Fig. 2C) have not been considered in the inversion process. The velocities were calculated down to horizon IB/H5 , marked with a black continuous line in Fig. 2(C).
The obtained velocities are superimposed on the GPR profile in Fig. 5. The velocities always decrease with depth, but show also quite high lateral variations. The minimum values are close to 17 cm ns–1 , typical of pure ice (Bradford et al. 2009). The calculated velocities correspond to the main glaciological units (Fig. 2C). For instance, the almost transparent layer interpreted as firn (with local debris) shows relatively low velocities, especially in the thickest zones. This is valid in general and can be explained by considering that the density of the frozen materials tends to increase with increasing glaciostatic pressure. Moreover, only small velocity (and density) variations show up in the firn interval (e.g. reflector h4 ), since the glacial metamorphism annihilates the original differences.
We analysed the uncertainties by applying the propagation of maximum errors (e.g. Fornasini 2008) to all the equations used in the inversion process, in order to evaluate the reliability of the obtained results. We associated an uncertainty of ±0.20 cm ns–1 to the Velocity analysis from common offset GPR data  1479  velocity of the first layer, while for all the other inputs we considered a maximum error of half the last significant digit. With these values, the mean errors reach a maximum of 0.23 cm ns–1 at the deepest layer, which is a quite good result for any practical application. We can note that, beside the initial horizon interpretation and amplitude picking, the proposed inversion method is completely independent from the interpreter and the EM velocities can be calculated for each layer in each trace. It is nonetheless advisable to apply a smoothing operator on the inversion results, to better highlight the main velocity changes along the profile and to filter out the inevitable outliers. The smoothing operator should be designed considering the final objectives of the analysis, in particular the horizontal resolution: a 61 traces moving average operator was selected for the present case (Fig. 5).

DISCUSSION 
The tests performed on several synthetic and field data sets (at different frequencies) allow a detailed analysis of the crucial elements to be considered in order to obtain reliable results from the implemented velocity analysis procedure. Each point is here separately discussed.
Dip of the reflectors 
In a one-layer model (Fig. 6) the angle of incidence (θ) at the interface depends on geometric parameters, such as offset (x), dip (α) and depth of the reflector (in Fig. 6, distance (H) between reflector and transmitting antenna S), and it can be calculated from:
Eq. (27) can be extended to reflections in a multilayered system but, for simplicity, we will just refer to the case depicted in Fig. 6.
Eq. (27) is plotted in Fig. 7 as a function of α and r. It shows that the incident angle goes quickly to zero for increasing depths of the interface with respect to the offset. On the ordinate axis (i.e. for an  horizontal layer), the angle θ as a function of r is equal to 45◦ at 0.5, 26.6◦ at 1 and 5.7◦ at 5. The decrease is even faster at higher values of α, that is, for steeper interfaces.
The graph in Fig. 7 indicates that the incident angle is considerably small except in a very limited region. For example, θ is smaller than 20◦ for a value of r greater than 1.4 in case of a horizontal layer (α = 0), or even smaller for greater values of α.
This is an important point if we consider the graph in Fig. 8, which shows the difference between the reflection coefficients in the TE case and in the normal incidence case (RT E − R⊥ ), as a function of the incident angle (θ ) and the permittivity contrast (p) between the lower (ε2 ) and upper (ε1 ) layers:
The graph shows that, for most permittivity contrasts, there is a small variation of RT E with respect to R⊥ , at small values of the incident angle (especially at angles smaller than the reference angle of 20◦ ). Moreover, in the case of low permittivity contrasts (p ≈ 1), the variation is small even at greater incident angles.
Therefore, in most subsurface conditions, the approximation of a locally multilayered medium with plane, parallel interfaces is acceptable, since the actual slope of the layers does not basically affect the inversion results. In fact, in most real situations, the incident angles can be considered small (Fig. 7), and at small incident angles the reflection coefficient does not vary much (Fig. 8).
This point is very important in the application of the method, since we do not know in advance the subsurface geometry, which is one of the objectives of the geophysical survey. This information is essential to reconstruct the actual ray paths but, as demonstrated, the described assumptions can be considered a good approximation, except in some uncommon and very peculiar situations.
 
Thin layers  
If the thickness of a layer is small with respect to the dominant wavelength (λ) of the GPR wave (‘thin layer’), the Fresnel equations cannot be longer used to calculate the reflectivity. Therefore, interference due to thin layers should be avoided while picking the amplitudes to be used in the inversion procedure. However, numerical simulations demonstrate that the Fresnel equations are a reasonable approximation to calculate the reflected/transmitted amplitudes when the layer thickness is higher than 0.75 λ (Bradford & Deeds 2006), over a broad range of permittivity contrasts and at incident angles smaller than 45◦ . In most conditions, the Fresnel approach is a reasonable approximation even if the thin-bed reflection amplitude is a complex function of the signal wavelet spectrum, the permittivity contrasts, the antenna directivity and not only of the layer thickness. In Table 4, we calculated the minimum layer thickness below which the Fresnel approach can no longer be used, at different EM frequencies and for two velocities that represent the extreme values in most practical GPR applications. The calculated values show that the validity range of Fresnel equations is quite large in many GPR applications also in the worst cases (i.e. low frequency antennas and high velocity media).
In Table 4, we also provide an estimation of the minimum depth at which a reflected event can be imaged. The air and ground waves arrivals prevent the interpretation and the amplitude picking of any reflection from shallower interfaces. For such estimation, we set the wavelet length equal to 1.5 times the dominant wavelength (i.e. a three phases transient) and we consider offset values typical of different commercial GPR antennas. The dimension of this zone plays an important role in the practical application of the proposed procedure since the small incident angle approximation is not realistic at very shallow levels. The extensions of the ‘shadow zone’ for the typical offsets used in CO applications (i.e. 1 m for 100 MHz; 0.75 m for 200 MHz; 0.50 m for 400 MHz and 0.25 m for 800 MHz antennas), calculated applying eq. (3) and shown in the second to last column of Table 4, are relatively large also for high frequencies and low velocity materials.
As a consequence, our method can be applied to any interpretable reflection, since the incident angles are low enough also for the shallowest possible cases and the lowest velocity materials (see last column on Table 4 calculated by using eq. 4). In other words, the 45◦ limit for the incident angle is almost always satisfied in GPR CO data acquisitions.
Real applications show that even using the amplitudes picked for interfering reflectors (e.g. the portion highlighted by the black horizontal arrow in Figs 2 and 5) the calculated velocities are realistic enough for a practical use.

Reference amplitude  
The reference amplitude is a crucial parameter of the procedure. The reference wavelet of a GPR system is unknown, as for any impulsive source, and, therefore, different strategies to evaluate the effective transmitted transient can be adopted. For example, Bano (2004) considered as source wavelet the interference between air and ground waves averaged over all the traces of CO sections.
We noted that a valid strategy is to pick as reference amplitude the maximum value of the airwave for any analysed trace. Modern GPR systems are highly repetitive and, therefore, the waveform emitted by the transmitting antenna varies only slightly, if at all, from trace to trace. Problems can arise from interference between air and ground waves, especially at small offsets in high-velocity media. In such situations the picked reference values can be not representative of the actual amplitude of the transmitted pulse, thus producing erroneous estimations. Moreover, the directivity of the antenna, and, therefore, its radiation pattern into the subsurface, is a further problem, especially for highly conductive materials. In these cases, the radiation pattern is strongly distorted and not comparable with the one in air and in virtually lossless materials, like pure ice (Balanis 1989; Turner 1994). On the other hand, we experimentally found that the inversion procedure is quite robust since the reflection coefficients, and so the reflected amplitudes, are often quite small. For instance, in the analysed data, if the uncertainty of the reference amplitude changes to 20 per cent of the amplitude itself while all the other input remain the same, the mean error of the estimated velocities in the deepest layer changes from ±0.23 up to ±0.67 cm ns–1 . This is still quite satisfactory in many practical uses, if we consider that most of the former uncertainty results from the estimation of the velocity of the first layer (see discussion of Table 2).
Another approach is to consider, instead of the amplitude of the first event, the trace envelope (instantaneous amplitude or reflection strength), which is a measure of the reflectivity strength (Arcone et al. 2003; Gacitúa et al. 2012). This attribute is proportional to the square root of the whole energy of the signal at an instant in time, which gives an outline of the energy distribution. As reported by Forte et al. (2013), the results obtained for the two cases are comparable.
Other promising approaches are to perform dedicated transillumination experiments or to acquire reference traces by placing the antennas raised above the ground surface, to better measure the airwave signature.

Velocity of the first layer  
The EM velocity of the shallowest layer is the most important input of the entire inversion procedure, since a large error in such parameter will produce strong changes of all the calculated velocities. Nevertheless, the velocity of the shallowest layer can be determined by combining analyses of the first reflection and of the ground wave on available CMP gathers, or by dedicated transillumination experiments (or even by using direct density measures for frozen materials). The integration of GPR common offset data with other geophysical techniques, like TDR measurements, could further improve the determination of this parameter. The proposed procedure can fail if the first layer’s reference velocity is sensibly higher or lower than the real one. Both cases may produce negative or imaginary values for layer thicknesses, or unrealistic velocities. On the other hand, a slightly wrong velocity input would produce erroneous results in terms of absolute values, but not in the velocity contrasts since the reference velocity is a normalizing factor. Also, the errors associated with the velocity results will constitute a valuable information on the effect of the uncertainty of the used reference velocity.

CONCLUSIONS 
We implemented and validated a method to estimate the EM wave velocity field from CO GPR data by using the reflection amplitudes picked on GPR profiles. The amplitude of the EM transient injected into the ground (reference amplitude) and the velocity value in the first layer are essential input parameters of the procedure. The assumption that the reference amplitude is the maximum amplitude of the airwave appears robust. A 20 per cent change of the mean reference amplitude actually produces changes of the calculated velocities in the order of ±1 cm ns–1 , which is still quite satisfactory for many practical uses and comparable with the uncertainties of other more time-consuming velocity analysis techniques.
On the other hand, our error analysis demonstrated that the uncertainty in the estimation of the velocity of the first layer is the main cause of uncertainty in the calculated velocity field. Nevertheless, the velocity of the shallowest layer can be constrained by combining analyses of the first reflection and of the ground wave on available CMP gathers, or by using other geophysical techniques like TDR measurements, or dedicated trans-illumination experiments.
The proposed technique is appropriate for any antenna’s frequency and offset. We demonstrated that for most of the real GPR applications the small spread approximation, for which the incident angles are small, is acceptable even for the shallowest detectable targets.
Since the inversion technique is based on the reflected amplitudes, an accurate data processing is essential before any amplitude picking: the most important step is the amplitude recovery. We found that divergence correction applied with a constant velocity is an acceptable compensation of the amplitude decay for media having negligible intrinsic attenuation. More sophisticated algorithms that take into consideration variations in the antenna/ground coupling and in the antenna’s radiation pattern due to changes in the subsurface materials, would be more accurate, but surely difficult to apply for practical uses.
Migration procedures (such as, e.g. FK, Kirchhoff, finite difference) are effective in removing diffractions, which are common in some GPR data set. All such algorithms need an input velocity model that can be best obtained through costly MVA procedures: the approximations implicit in post-stack migration methods frequently leave diffraction residuals in the section. We therefore tested the proposed method also on not migrated sections. The procedure is robust and statistically valid, since the scattering is usually only local and the amplitude inversion takes into account a large number of traces. In other words, the scattering events can be considered as outliers in the velocity field, and do not significantly affect the mean estimated velocities.
In the proposed tests, we considered the subsurface material as not dissipative and not dispersive. While the latter assumption is satisfied for most practical applications, large dissipation is often observed in GPR data due to the high intrinsic attenuation of several geological materials. In such conditions, the procedure can still be applied if the data are properly corrected for intrinsic attenuation effects. Such topic deserves further research to improve the comprehension not only of the kinematic, but also of the dynamic behaviour of the EM waves in real media and practical field conditions.

ACKNOWLEDGEMENTS 
The University of Trieste partially supported this research with the ‘Finanziamento di Ateneo per progetti di ricerca scientifica— FRA-2012’ grant. We gratefully acknowledge Halliburton through the University of Trieste Landmark academic grant. We kindly thank Francesca Bearzot, Marco B. Bondini, Costanza Del Gobbo, Stefano Pierobon and Marco Venier for the fieldwork operations and assistance during geophysical data acquisition, and Daniele Moro, Luciano Lizzero, Gabriele Amadori and Sergio Buricelli of the Direzione Centrale Risorse Rurali, Agroalimentari e Forestali Servizio neve e valanghe FVG for the logistic support. We are also in debt with Promotur-Sella Nevea, in the person of Alberto Schiavi, for the logistic support and with the Parco Naturale Regionale delle Prealpi Giulie. The authors thank the editor René-Edouard Plessix  and an anonymous reviewer for their constructive comments and helpful suggestions, which improved the quality of the manuscript.

Figures
Sketch of the incident and reflected raypaths for horizontally layered media. S represents the transmitter (Source), R the receiver, x is the offset between the antennas, h i and vi are respectively the thicknesses and EM velocities of the layers, while θi and xi are respectively the incident angles and the horizontal projections of the travel path of the third reflection, chosen as an example.
Example of 300 MHz profile: (A) original; (B) processed applying the following processing sequence: DC removal, time drift removal, windowed spatial filtering, bandpass filtering and amplitude recovery through divergence correction; (C) same as (B), interpreted. Labels h0 –h5 highlight the main horizons within the frozen materials. IB, ice bottom. Continuous lines represent the portions of reflectors used for amplitude picking and velocity estimation. T marks the position of the trench centre, while R is the picking of the reference amplitude used in the inversion procedure. The black line connecting part of reflector IB with h5 represents the lowermost limit for the velocity estimation. The horizontal double arrows underline a zone where horizons h2 and h3 interfere, while the grey rectangle limits a zone where no velocity estimations are performed due to the lack of clear reflectors. Main glaciological units: snow, firn and ice with debris are depicted in blue, green and yellow, respectively.
Example of GPR profiles intersecting the snow pit used to directly measure the frozen material densities. (A) and (B) 300 MHz profiles crossing each other; (C) same as (B) acquired with 500 MHz antennas. T marks the location of the trench along the profiles. The trench bottom (340 cm below the topographic surface) is also highlighted and is located just above a highly reflective horizon (h1 ) related to a strong EM (and so density) contrast. Labels of the marked horizons are the same as in Fig. 2. Horizontal segments highlight the main density contrasts. For clarity only one trace every five is plotted.
Velocities calculated from the amplitudes picked along the horizons h1 –h5 on Fig. 3 for three independent profiles: (A) and (B) 300 MHz profiles; (C) same as (B) acquired with 500 MHz antennas. In the graphs, each label (h1 –h5 ) points to the velocity distribution in the layer above the related horizon. T marks the position of the centre of the snow pit and the crossing point between profiles B and C with A. All the graphs have the same velocity range (16.5– 20.5 cm ns–1 ) and a total of 20 traces at each side of the pit position. The picked amplitudes of the 500 MHz profile have been multiplied by a factor 3 before the inversion.
GPR profile of Fig. 2, with superimposed velocities obtained from the inversion of the reflected amplitudes. The shallowest layer has a constant velocity fixed at 20 cm ns–1 . The plotted velocities are smoothed with a 61 traces moving average in order to limit the effects of unavoidable outliers and to highlight the main lateral velocity changes.
Scheme of the reflected ray path for a generic dipping horizon at non-zero offset.
Contour plot of eq. (27), with the slope (α) in the abscissa and the ratio (H/x) in the ordinate. The angle θ reaches 90◦ at the origin, decreasing rapidly as we move away from the origin.
Variation (RT E − R⊥ ) of the reflection coefficient with respect to the normal incidence case, as a function of the permittivity contrast (ε2 /ε 1 ) in the abscissa and the incident angle (θ ) in the ordinate. Such difference is always null along the abscissa axis (normal incidence case: θ = 0).

Tables
Velocity models used in forward modelling. The layers are homogeneous and have the same thicknesses but different velocities in the three models.
Results of the inversion of numerically simulated data obtained from the models in Table 1, at offset 0.5 and 1.5 m. The values of each layer are consistent with the initial models. Velocity value and associated uncertainty of the shallowest layer are input parameters of the inversion procedure: the latter mainly affects error estimation.
Inversion results obtained from the models in Table 1, 0.5 and 1.5 m offsets, normal incidence approximation. The results show that the difference between the calculated mean values and the initial models increases with the deviation of incident angles from the normal incidence case. On the other hand, error estimation does not exhibit a clear increment of uncertainties with depth, because the only quantity used in the iteration is the dielectric permittivity. Values inconsistent with the original model are marked in bold. The velocity values and the uncertainties of the shallowest layer are input parameters of the inversion procedure.
Wavelength, limit of optical resolution, limit of the applicability of Fresnel equations (Bradford & Deeds, 2006 criterion), minimum depth (MD) of the first visible reflector and its incidence angle, calculated for different EM velocities, frequencies and offsets. MD was calculated considering a wavelet extension equal to 1.5 times the dominant wavelength.













